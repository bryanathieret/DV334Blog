<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Bryana A.S. Thieret">
<meta name="dcterms.date" content="2024-03-02">

<title>Bryana’s Blog - Deaths from Overdose in the United States between 1999 to 2021</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Early-Life Stress and Impulsivity</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/bryanathieret"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content column-page" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Deaths from Overdose in the United States between 1999 to 2021</h1>
  <div class="quarto-categories">
    <div class="quarto-category">news</div>
  </div>
  </div>



<div class="quarto-title-meta column-page">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Bryana A.S. Thieret </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 2, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Death from overdose of a substance, or multiple substances, is a sign of a much larger problem than substance abuse or misuse. If you don’t believe in the idea of free will, like myself, then that means that substance abuse occurs because of a persons reinforcement history, current environment, and their biological makeup (i.e., substance use is preventable and is a sign of societal inequities). Substance use when started, is extremely hard to extinguish because it is chemically/behaviorally addictive and relapse/resurgence is very common due to the established history of reinforcement with the substance (e.g., place can be a trigger for relapse, people can be a trigger for relapse, trauma can be a trigger for relapse, etc.,). This makes it especially difficult to treat and establish maintenance behavior for substance use.</p>
<p>I am particularly interested in this data because we know those who have a history of adversity or adverse childhood events have an increased risk for early and life time substance use dependence compared to the general population (Kim et al., 2018; Shin et al., 2018; Strine et al., 2012; Pilowsky et al., 2009; Loudermilk et al., 2018; Dube et al., 2003; Gomez et al., 2018; Stein et al., 2017; Guarino et al., 2021; Sachs-Ericsson et al., 2017; Perez et al., 2016; Dube et al., 2001). That being said, not everyone who overdoses on a substance has a history of adversity, but it is more likely for those with a history of adverse childhood events to engage in substance use.</p>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<p>The data set used in this exploration was from the National Institute on Drug Abuse in the article named “Drug Overdose Death Rates” and can be found <a href="https://nida.nih.gov/research-topics/trends-statistics/overdose-death-rates">here</a> as a downloadable link in the article. The data set includes the number of deaths per year between 1999 through 2021 categorized by the type of substance(s) that caused the death. There were many categories but I ultimately decided to group these categories further by the substance medication class (i.e., opioids, opiates, narcotics, stimulants, etc.,). The exact grouping were as follows,</p>
<ul>
<li>Opioids: synthetically derived opiates.
<ul>
<li>Prescription opioids (<code>Prescription Opioids2</code>)<br>
</li>
<li>Prescription opioids other than methadone (<code>Prescription Opioids WITHOUT Synthetic Opioids other than Methadone</code>)<br>
</li>
<li>Synthetic opioids (<code>Synthetic Opioids other than Methadone (primarily fentanyl)3</code>)</li>
</ul></li>
<li>Opiates: compounds that are extracted or refined from natural plant matter (poppy sap and fibers).
<ul>
<li>Heroin (<code>Heroin4</code>)</li>
</ul></li>
<li>Narcotics: this includes both opiates and opioids.
<ul>
<li>Both opiates and opioids (<code>Any Opioid1</code>)<br>
</li>
<li>Prescription and synthetic opioids other than methadone (<code>Prescription Opioids AND Synthetic Opioids other than Methadone</code>)<br>
</li>
<li>Heroin and synthetic opioids other than methadone (<code>Heroin AND Synthetic Opioids other than Methadone</code>)<br>
</li>
<li>Heroin and methadone (<code>Heroin WITHOUT Synthetic Opioids other than Methadone</code>)</li>
</ul></li>
<li>Stimulants: this includes cocaine, psychostimulants, and psychostimulants with abuse potential.
<ul>
<li>Stimulants without any opioids present (<code>Stimulants WITHOUT Any Opioid</code>)<br>
</li>
<li>Stimulants without any synthetic opioids present (<code>Stimulants WITHOUT Synthetic Opioids other than Methadone</code>)<br>
</li>
<li>Cocaine without any opioid present (<code>Cocaine WITHOUT Any Opioid</code>)<br>
</li>
<li>Cocaine without any synthetic opioids present (<code>Cocaine WITHOUT Synthetic Opioids other than Methadone</code>)<br>
</li>
<li>Psychostimulants with abuse potential (<code>Psychostimulants With Abuse Potential (primarily methamphetamine)6</code>)<br>
</li>
<li>Psychostimulants with abuse potential without any opioid present (<code>Psychostimulants With Abuse Potential WITHOUT Any Opioid</code>)<br>
</li>
<li>Psychostimulants with abuse potential without any synthetic opioids present (<code>Psychostimulants With Abuse Potential WITHOUT Synthetic Opioids other than Methadone</code>)</li>
</ul></li>
<li>Benzodiazepine: depressants that produce sedation, relieve anxiety, reduces seizures, and are controlled substances because they are prone to misuse.
<ul>
<li>Benzodiazepine without any opioid present (<code>Benzodiazepines WITHOUT Any Opioid</code>)<br>
</li>
<li>Benzodiazepine without any synthetic opioid present other than methadone (<code>Benzodiazepines WITHOUT Synthetic Opioids other than Methadone</code>)</li>
</ul></li>
<li>Antidepressant: there are many types of antidepressants which include SSRIs, SNRIs, NASSAs, TCAs, SARIs, and MAOIs.
<ul>
<li>Antidepressants without any opioid present (<code>Antidepressants WITHOUT Any Opioid</code>)<br>
</li>
<li>Antidepressants without synthetic opioids present (<code>Antidepressants WITHOUT Synthetic Opioids other than Methadone</code>)</li>
</ul></li>
<li>Stimulants and Opioids:
<ul>
<li>Stimulants and any opioid present (<code>Stimulants AND Any Opioid</code>)<br>
</li>
<li>Cocaine and any opioid present (<code>Cocaine AND Any Opioid</code>)<br>
</li>
<li>Psychostimulants with abuse potential and any opioid present (<code>Psychostimulants With Abuse Potential AND Any Opioid</code>)</li>
</ul></li>
<li>Stimulants and Narcotics:
<ul>
<li>Stimulants and narcotics (<code>Stimulants AND Synthetic Opioids other than Methadone</code>)<br>
</li>
<li>Cocaine and narcotics (<code>Cocaine AND Synthetic Opioids other than Methadone</code>)<br>
</li>
<li>Psychostimulants with abuse potential and narcotics (<code>Psychostimulants With Abuse Potential AND Synthetic Opioids other than Methadone</code>)</li>
</ul></li>
<li>Benzodiazepine and Opioids:
<ul>
<li>Benzodiazepine and any opioid present (<code>Benzodiazepines AND Any Opioid</code>)</li>
</ul></li>
<li>Benzodiazepine and Narcotics:
<ul>
<li>Benzodiazepine and narcotics present (<code>Benzodiazepines AND Synthetic Opioids other than Methadone</code>)</li>
</ul></li>
<li>Antidepressant and Opioids:
<ul>
<li>Antidepressant and any opioid present (<code>Antidepressants AND Any Opioid</code>)</li>
</ul></li>
<li>Antidepressant and Narcotics:
<ul>
<li>Antidepressant and narcotics present (<code>Antidepressants AND Synthetic Opioids other than Methadone</code>)</li>
</ul></li>
</ul>
</section>
<section id="reasons-for-exploration" class="level3">
<h3 class="anchored" data-anchor-id="reasons-for-exploration">Reasons for Exploration</h3>
<p>If you go to the article where this data came from there is a relatively good write up with both tables, graphs, and interpretations but the way the author categorized the drugs did not, in my opinion, differentiate between opiates and opioids. Both opiates and opioids are highly addictive substances (primary reinforcers), but they neurochemically work differently within our nervous systems which is why it is important to not categorize the substances together as the same because they are indeed not the same. This exploration will dive into understanding if there are different trends over time for opiate vs opioid overdoses in addition to polysubstance use involving opioids and opiates. In addition, there is relatively building evidence of biological sex differences for substance addiction so in order to control for those potential differences we will be differentiating between the number of overdoses by sex for all categorizations.</p>
</section>
</section>
<section id="death-from-overdose-in-the-united-states-by-year" class="level2">
<h2 class="anchored" data-anchor-id="death-from-overdose-in-the-united-states-by-year">Death from Overdose in the United States by Year</h2>
<section id="opiates" class="level3">
<h3 class="anchored" data-anchor-id="opiates">Opiates</h3>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Overdoses_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Viewing at a global perspective, heroin overdoses are second derivative negative starting around 2016 showing both males and females to equally as effected (i.e., mirroring each other). On the other hand, prescription opiates look unstable in terms of the number of overdoses from 2020 to 2021 where males overdoses increased sharply and females overdosed on the substance significantly less. We know that supply and ultimately cost of a substance is going to effect whether a person takes a particular substance. This sudden decrease for overdoses for prescription opiates for females is most likely due to switching to another substance that has similar reinforcing value (i.e., the way it makes the person feel) but is more available/cheaper.</li>
</ul>
</section>
<section id="opioids" class="level3">
<h3 class="anchored" data-anchor-id="opioids">Opioids</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Overdoses_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Prescription opioids appear to have been climbing in the number of overdoses since 1999 which is extremely concerning as a society. Fentanyl has become a more popular substance lately especially for overdoses because the concentration of the substance is much higher than any other opioid or opiate. Even though fentanyl has recently been causing the majority of overdoese in the recent years, it is not a new drug and has been around for decades as a pain medication often given as a shot or through IV.</li>
</ul>
</section>
<section id="opiates-vs.-opioids" class="level3">
<h3 class="anchored" data-anchor-id="opiates-vs.-opioids">Opiates vs.&nbsp;Opioids</h3>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Overdoses_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>This graph shows that overdoses from opiates has been decreasing as a rate, second derivative negative, since 2015 for both males and females. On the other hand there appears to be a shift to increased overdoses as a rate over years, second derivative positive, for both males and females which is concerning because the trend only appears to be continuing to increase, and predicatively, will continue to increase.</li>
</ul>
</section>
</section>
<section id="polysubstance-use" class="level2">
<h2 class="anchored" data-anchor-id="polysubstance-use">Polysubstance Use</h2>
<p>It is relatively common for multiple substances to be taken together which can be harder for a persons body to process leading to health complications (e.g., heart attack) but also can increase the risk of overdosing because substances can be laced with other substances that might create a biologically problematic interaction or too much of a particular substance. Since opiates and opioids have been lumped together in regards to polysubstance overdoses, I will show the number of overdoses for a substance without the presence of a narcotic and the same substance with the presence of a narcotic.</p>
<section id="stimulants" class="level3">
<h3 class="anchored" data-anchor-id="stimulants">Stimulants</h3>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Overdoses_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Interestingly, stimulants were not previously taken with narcotics between 1999 to 2012, but around 2013 for males and 2015 for females, stimulants and narcotics began to be mixed together causing overdoses. In a similar trend, both males and females in the past 4 years have been overdosing at higher rates when stimulants are mixed with narcotics compared to stimulants being taken alone.</li>
</ul>
</section>
<section id="benzodiazepine" class="level3">
<h3 class="anchored" data-anchor-id="benzodiazepine">Benzodiazepine</h3>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Overdoses_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>This graph shows very obviously that those using both narcotics and benzodiazepine often results in some type of overdose death. Benzodiazepine can cause hallucinations which could impair a persons ability to make rational decisions, but also judgement of their perceived “highness” causing them to take too much of a narcotic leading to overdose.</li>
</ul>
</section>
<section id="antidepressants" class="level3">
<h3 class="anchored" data-anchor-id="antidepressants">Antidepressants</h3>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Overdoses_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>From 2006 through 2021, there is a clear trend of females overdosing overall at a much higher rate compared to males generally speaking for both antidepressants alone and when antidepressants and narcotics are present. We can reasonably say those overdosing on antidepressants is a type of suicide, but it is hard to say if the antidepressant found in a toxicology report was their daily medication or if it was at a much higher dose along with either a opiate or opioid which would mean different things.</li>
</ul>
<hr>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Overdoses_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="discussion" class="level2">
<h2 class="anchored" data-anchor-id="discussion">Discussion</h2>
<p>1,004,401 people have died between 1999 through 2021 to substance overdose. Over the past few years, substance overdose has increased exponentially. Outpatient centers are essential to help those with addictions pick up their life, but what is not often acknowledged is that those who have a history of substance addiction are prone to relapse, not because of their lack of self control, but because they have a history of reinforcement with the substance that will never go away. The way to treat substance addiction is to prevent it from occurring all together rather than as a society caring once it is way too late.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>